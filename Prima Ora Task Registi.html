<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prima Ora - Bacheca Lavoro</title>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap');
        body{font-family:'Roboto',sans-serif;color:#333;margin:0;padding:2rem;display:flex;flex-direction:column;align-items:center}#background-video{position:fixed;left:0;bottom:0;min-width:100%;min-height:100%;width:auto;height:auto;z-index:-100;object-fit:cover}.controls-container{display:flex;gap:10px;margin-bottom:1rem;background-color:rgba(255,255,255,.2);backdrop-filter:blur(10px);padding:.5rem 1rem;border-radius:8px}.controls-container button{padding:8px 15px;border-radius:5px;border:1px solid #fff;background-color:#2c3e50;color:#fff;font-weight:700;cursor:pointer;transition:background-color .2s}.controls-container button:hover{background-color:#34495e}.day-selector{display:flex;justify-content:center;flex-wrap:wrap;margin-bottom:2rem;background-color:rgba(255,255,255,.2);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);padding:1rem;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,.05)}.day-selector button{backdrop-filter:blur(5px);-webkit-backdrop-filter:blur(5px);border:1px solid rgba(255,255,255,.8);border-radius:5px;padding:10px 15px;margin:5px;font-size:.9rem;cursor:pointer;transition:background-color .2s,color .2s,border-color .2s;color:#fff;font-weight:700}.day-color-0{background-color:rgba(255,179,186,.7)}.day-color-1{background-color:rgba(255,223,186,.7)}.day-color-2{background-color:rgba(255,255,186,.7)}.day-color-3{background-color:rgba(186,255,201,.7)}.day-color-4{background-color:rgba(186,225,255,.7)}.day-color-5{background-color:rgba(215,186,255,.7)}.day-color-6{background-color:rgba(255,186,236,.7)}.day-selector button.active{background-color:#2c3e50;color:#fff;border-color:#fff}
        .kanban-board{display:flex;flex-direction:column;align-items:center;gap:1rem;width:100%;max-width:1200px}
        .columns-container{display:flex;gap:2rem;justify-content:center;width:100%}
        .column{background:rgba(255,255,255,.1);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);border:1px solid rgba(255,255,255,.2);padding:1.5rem;border-radius:8px;width:300px;min-height:500px;box-shadow:0 4px 30px rgba(0,0,0,.1);display:flex;flex-direction:column}.column.done-column{width:250px}.column-header{font-size:1.5rem;font-weight:700;margin-bottom:1rem;color:#eee;text-shadow:1px 1px 3px rgba(0,0,0,.4);text-align:center}.add-task{display:flex;margin-bottom:1rem}.add-task input{flex-grow:1;padding:10px;border:1px solid #ccc;border-radius:5px;font-size:.9rem}.add-task button{padding:10px 15px;border:none;background-color:#2c3e50;color:#fff;border-radius:5px;margin-left:5px;cursor:pointer;font-size:.9rem}.task-list{flex-grow:1;overflow-y:auto;position:relative;min-height:100px}.task-card{background:rgba(255,255,255,.2);padding:1rem;border-radius:5px;margin-bottom:1rem;cursor:grab;box-shadow:0 1px 3px rgba(0,0,0,.1);transition:transform .2s ease-in-out,box-shadow .2s ease-in-out;position:relative}.task-card:active{cursor:grabbing}.task-card.dragging{opacity:.5;box-shadow:0 4px 15px rgba(0,0,0,.2);transform:scale(1.05)}
        .task-card.done{background:rgba(46,204,113,.2);color:#333}.task-card.done h4{text-decoration:none;color:#c0392b}
        .task-card.done .task-buttons{display:none}.task-card.done .content-tags button{opacity:.5;pointer-events:none}.task-card-header{display:flex;justify-content:space-between;align-items:center}.task-card h4{margin:0 0 .5rem;font-size:1.1rem;color:#c0392b;flex-grow:1;cursor:text}.task-card h4[contenteditable=true]{background-color:rgba(255,255,255,.8);outline:2px solid #3498db;border-radius:3px;padding:2px 4px;margin:-2px -4px .5rem -4px;color:#333}.info-field-container{margin-top:10px}.info-field-container label{font-size:.9rem;font-weight:700;color:#444;display:block;margin-bottom:5px}.info-field{width:calc(100% - 10px);padding:5px;border:1px solid #ccc;border-radius:3px;font-size:.9rem;resize:vertical;font-family:inherit}.task-card .task-buttons{display:flex;justify-content:space-between;margin-top:1rem}.task-card .task-buttons button,.minimize-btn{background:0 0;border:none;cursor:pointer;font-size:1.2rem;color:#333;transition:color .2s}.minimize-btn{font-size:1rem;margin-left:10px;padding:0 5px}.task-card .task-buttons button:hover,.minimize-btn:hover{color:#000}.task-card.minimized .task-body{display:none}.task-card.minimized h4{margin-bottom:0}.content-tags{display:flex;flex-wrap:wrap;align-items:center}
        .content-tags button{padding:5px 10px;border-radius:20px;border:none;cursor:pointer;color:#fff;font-size:.8rem;margin-right:5px;margin-bottom:5px;opacity:.3;transition:opacity .2s,filter .2s;filter:grayscale(60%)}.content-tags button.active{opacity:1;filter:grayscale(0%)}
        .content-tags .foto{background-color:#ff6347}.content-tags .video{background-color:#4682b4}.content-tags .grafico{background-color:#3cb371}.content-tags .titolo{background-color:#ffa500}.content-tags .cartina{background-color:#a0522d}.project-tag{padding:5px 10px;border-radius:20px;border:1px solid #ccc;cursor:pointer;font-size:.8rem;margin-right:5px;margin-bottom:5px;background-color:#2c3e50;color:#fff}
        .daily-author-container{display:flex;align-items:center;gap:10px;background-color:rgba(0,0,0,.2);padding:10px 15px;border-radius:8px;width:100%;max-width:400px}.daily-author-container label{font-weight:700;color:#fff;text-shadow:1px 1px 2px #000}.author-input{flex-grow:1;padding:8px;border-radius:5px;border:1px solid #777}
        .location-container h5{margin:.8rem 0 .5rem;font-size:1rem;color:#444}.location-buttons{display:flex;gap:10px;margin-bottom:.5rem}.location-btn{padding:5px 10px;font-size:.8rem;border-radius:5px;border:1px solid #aaa;background-color:#eee;cursor:pointer}.location-btn.active{background-color:#3498db;color:#fff;border-color:#3498db}
        @media (max-width:900px){.kanban-board{flex-direction:column;align-items:center}.column{width:100%;max-width:400px;margin-bottom:20px}.columns-container{flex-direction:column;align-items:center;width:100%;gap:1rem}}
    </style>
</head>
<body>
    <video autoplay muted loop id="background-video">
        <source src="background.mp4" type="video/mp4">
        Il tuo browser non supporta il tag video.
    </video>

    <script>
        const firebaseConfig = { apiKey: "AIzaSyD3Ry99dV34fUo6NfzZ5ykSjPcJN1gl8mk", authDomain: "prima-ora-task-registi.firebaseapp.com", projectId: "prima-ora-task-registi", storageBucket: "prima-ora-task-registi.firebasestorage.app", messagingSenderId: "1090920780195", appId: "1:1090920780195:web:89059a93c18fc97bc08a16" };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
    </script>

    <div class="controls-container">
        <button id="export-btn">Esporta Dati</button>
        <button id="import-btn">Importa Dati</button>
        <input type="file" id="import-file-input" accept=".json" style="display: none;">
    </div>

    <div class="day-selector" id="day-selector"></div>
    <div id="kanban-container"></div>
    
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const daysToDisplay = 8;
            generateDaySelectors(daysToDisplay);
            document.getElementById('export-btn').addEventListener('click', exportData);
            const importFileInput = document.getElementById('import-file-input');
            document.getElementById('import-btn').addEventListener('click', () => importFileInput.click());
            importFileInput.addEventListener('change', importData);
        });

        const dayNames = ['Domenica', 'Luned√¨', 'Marted√¨', 'Mercoled√¨', 'Gioved√¨', 'Venerd√¨', 'Sabato'];
        const monthNames = ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu', 'Lug', 'Ago', 'Set', 'Ott', 'Nov', 'Dic'];
        let activeDate = '';
        let unsubscribeListener = null;

        function exportData() {
            const dateToExp = activeDate;
            if(!dateToExp) {
                alert("Seleziona un giorno da esportare.");
                return;
            }
            db.collection('bacheche').doc(dateToExp).get().then(doc => {
                if (!doc.exists) {
                    alert("Nessun dato da esportare per questo giorno.");
                    return;
                }
                const dataToExport = doc.data();
                const jsonString = JSON.stringify(dataToExport, null, 2);
                const blob = new Blob([jsonString], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `backup-bacheca-${dateToExp}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            });
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;
            const dateFromFile = file.name.replace('backup-bacheca-', '').replace('.json', '');
            if (!/^\d{4}-\d{2}-\d{2}$/.test(dateFromFile)) {
                alert("Nome del file non valido. Deve essere nel formato 'backup-bacheca-YYYY-MM-DD.json'.");
                return;
            }
            if (!confirm(`ATTENZIONE: Stai per sovrascrivere i dati del giorno ${dateFromFile}. Vuoi continuare?`)) {
                event.target.value = ''; return;
            }
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const importedData = JSON.parse(e.target.result);
                    db.collection('bacheche').doc(dateFromFile).set(importedData).then(() => {
                         alert(`Dati per il giorno ${dateFromFile} importati con successo!`);
                    });
                } catch (error) {
                    alert('Errore: Il file selezionato non √® valido o √® corrotto.');
                } finally {
                    event.target.value = '';
                }
            };
            reader.readAsText(file);
        }

        function generateDaySelectors(count) {
            const selectorContainer = document.getElementById('day-selector');
            const kanbanContainer = document.getElementById('kanban-container');
            const today = new Date();
            for (let i = -2; i < count - 2; i++) {
                const day = new Date(today);
                day.setDate(today.getDate() + i);
                const dateString = day.toISOString().split('T')[0];
                const buttonText = `${dayNames[day.getDay()]} ${day.getDate()} ${monthNames[day.getMonth()]}`;
                const button = document.createElement('button');
                button.textContent = buttonText;
                button.setAttribute('data-date', dateString);
                button.classList.add(`day-color-${day.getDay()}`);
                button.addEventListener('click', () => switchDay(dateString));
                selectorContainer.appendChild(button);
                const kanbanBoard = document.createElement('div');
                kanbanBoard.id = `board-${dateString}`;
                kanbanBoard.className = 'kanban-board';
                kanbanBoard.style.display = 'none';
                kanbanBoard.innerHTML = `
                    <div class="daily-author-container">
                        <label for="author-input-${dateString}">Autore:</label>
                        <input type="text" id="author-input-${dateString}" class="author-input" placeholder="Nome autore...">
                    </div>
                    <div class="columns-container">
                        <div class="column" id="todo-column-${dateString}">
                            <h2 class="column-header">üìù Da Fare</h2>
                            <div class="add-task">
                                <input type="text" id="todo-input-${dateString}" placeholder="Aggiungi nuovo compito...">
                                <button class="add-btn" data-date="${dateString}">Aggiungi</button>
                            </div>
                            <div class="task-list" id="todo-list-${dateString}"></div>
                        </div>
                        <div class="column" id="in-progress-column-${dateString}"><h2 class="column-header">‚è≥ In Corso</h2><div class="task-list" id="in-progress-list-${dateString}"></div></div>
                        <div class="column done-column" id="done-column-${dateString}"><h2 class="column-header">‚úÖ Pronti</h2><div class="task-list" id="done-list-${dateString}"></div></div>
                    </div>`;
                kanbanContainer.appendChild(kanbanBoard);

                kanbanBoard.querySelector('.add-btn').addEventListener('click', () => {
                    const input = document.getElementById(`todo-input-${dateString}`);
                    if (input.value.trim() !== '') {
                        createTaskCard(input.value, {}, dateString);
                        input.value = '';
                        saveTasks(dateString);
                    }
                });
                kanbanBoard.querySelector('.author-input').addEventListener('change', () => saveTasks(dateString));
                kanbanBoard.querySelectorAll('.task-list').forEach(list => {
                    list.addEventListener('dragover', dragOver);
                    list.addEventListener('drop', drop);
                });
            }
            switchDay(new Date().toISOString().split('T')[0]);
        }
        
        function switchDay(date) {
            document.querySelectorAll('.day-selector button').forEach(btn => {
                btn.classList.toggle('active', btn.getAttribute('data-date') === date);
            });
            document.querySelectorAll('.kanban-board').forEach(board => {
                board.style.display = 'none';
            });
            document.getElementById(`board-${date}`).style.display = 'flex';
            activeDate = date;

            if (unsubscribeListener) {
                unsubscribeListener();
            }

            unsubscribeListener = db.collection('bacheche').doc(activeDate).onSnapshot(snapshot => {
                ['todo', 'in-progress', 'done'].forEach(type => {
                    const list = document.getElementById(`${type}-list-${activeDate}`);
                    if (list) list.innerHTML = '';
                });

                const data = snapshot.data();
                const authorInput = document.getElementById(`author-input-${activeDate}`);

                if (authorInput) authorInput.value = data?.autore || '';
                
                if (data) {
                    data.todo?.forEach(taskData => createTaskCard(taskData.text, { ...taskData, parentId: `todo-list-${activeDate}` }));
                    data.inProgress?.forEach(taskData => createTaskCard(taskData.text, { ...taskData, parentId: `in-progress-list-${activeDate}` }));
                    data.done?.forEach(taskData => createTaskCard(taskData.text, { ...taskData, parentId: `done-list-${activeDate}` }));
                }
            });
        }
        
        function saveTasks(date) {
            const author = document.getElementById(`author-input-${date}`)?.value || '';
            const tasks = { autore: author, todo: [], inProgress: [], done: [] };
            document.querySelectorAll(`#todo-list-${date} .task-card`).forEach(card => tasks.todo.push(serializeCard(card)));
            document.querySelectorAll(`#in-progress-list-${date} .task-card`).forEach(card => tasks.inProgress.push(serializeCard(card)));
            document.querySelectorAll(`#done-list-${date} .task-card`).forEach(card => tasks.done.push(serializeCard(card)));
            
            db.collection('bacheche').doc(date).set(tasks);
        }

        function createTaskCard(baseText, initialData = {}, date = activeDate) {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.setAttribute('draggable', 'true');
            card.id = initialData.id || `task-${date}-${Date.now()}`;
            card.innerHTML = `
                <div class="task-card-header"><h4 data-base-text="${baseText}"></h4><button class="minimize-btn">üîº</button></div>
                <div class="task-body">
                    <div class="info-field-container"><label>Descrizione:</label><textarea class="info-field descrizione-input" rows="2" placeholder="Descrizione..."></textarea></div>
                    <div class="content-tags">
                        <button class="foto" data-type="foto">Foto</button><button class="video" data-type="video">Video</button><button class="grafico" data-type="grafico">Grafico</button><button class="titolo" data-type="titolo">Titolo</button><button class="cartina" data-type="cartina">Cartina</button><button class="project-tag">PO</button>
                    </div>
                    <div class="info-field-container">
                        <label>Materiale:</label>
                        <textarea class="info-field materiale-input" rows="10" placeholder="Cosa, quando, ..."></textarea>
                    </div>
                    <div class="location-container">
                        <h5>Dove</h5>
                        <div class="location-buttons"><button class="location-btn" data-location="OpenMedia">in OpenMedia</button><button class="location-btn" data-location="Hive">in Hive</button></div>
                        <input type="text" class="info-field location-text" placeholder="X Chi">
                    </div>
                    <div class="info-field-container"><label>Link 1:</label><input type="text" class="info-field link-input-1" placeholder="Link, ..."></div>
                    <div class="info-field-container"><label>Link 2:</label><input type="text" class="info-field link-input-2" placeholder="Link, ..."></div>
                    <div class="info-field-container"><label>Link 3:</label><input type="text" class="info-field link-input-3" placeholder="Link, ..."></div>
                    <div class="task-buttons"><button class="edit-btn">‚úèÔ∏è</button><button class="delete-btn">üóëÔ∏è</button><button class="done-btn">‚úîÔ∏è</button></div>
                </div>`;
            
            if (initialData.isDone) card.classList.add('done');
            if (initialData.minimized) { card.classList.add('minimized'); card.querySelector('.minimize-btn').textContent = 'üîΩ'; }
            if (initialData.projectTag) card.querySelector('.project-tag').textContent = initialData.projectTag;
            if (initialData.descrizione) card.querySelector('.descrizione-input').value = initialData.descrizione;
            if (initialData.materiale) card.querySelector('.materiale-input').value = initialData.materiale;
            if (initialData.link1) card.querySelector('.link-input-1').value = initialData.link1;
            if (initialData.link2) card.querySelector('.link-input-2').value = initialData.link2;
            if (initialData.link3) card.querySelector('.link-input-3').value = initialData.link3;
            if (initialData.location) card.querySelector(`.location-btn[data-location="${initialData.location}"]`)?.classList.add('active');
            if (initialData.locationText) card.querySelector('.location-text').value = initialData.locationText;
            if (initialData.activeTags) {
                initialData.activeTags.forEach(tagType => {
                    const tagBtn = card.querySelector(`.content-tags button[data-type="${tagType}"]`);
                    if (tagBtn) tagBtn.classList.add('active');
                });
            }

            updateTitleWithPrefix(card);
            card.querySelector('h4').addEventListener('click', () => editTask(card));
            card.querySelector('.edit-btn').addEventListener('click', () => editTask(card));
            card.querySelector('.delete-btn').addEventListener('click', () => deleteTask(card));
            card.querySelector('.done-btn').addEventListener('click', () => toggleDone(card));
            card.querySelector('.minimize-btn').addEventListener('click', () => toggleMinimize(card));
            card.querySelector('.project-tag').addEventListener('click', () => toggleProjectTag(card.querySelector('.project-tag')));
            card.querySelectorAll('.content-tags button:not(.project-tag)').forEach(button => button.addEventListener('click', () => toggleTag(button)));
            card.querySelectorAll('.location-btn').forEach(button => {
                button.addEventListener('click', () => {
                    if (button.classList.contains('active')) {
                        button.classList.remove('active');
                    } else {
                        card.querySelectorAll('.location-btn').forEach(btn => btn.classList.remove('active'));
                        button.classList.add('active');
                    }
                    saveTasks(activeDate);
                });
            });
            card.addEventListener('dragstart', dragStart);
            card.addEventListener('dragend', dragEnd);
            if (initialData.isDone) document.getElementById(`done-list-${date}`).appendChild(card);
            else if (initialData.parentId) document.getElementById(initialData.parentId).appendChild(card);
            else document.getElementById(`todo-list-${date}`).prepend(card);
            card.querySelectorAll('.info-field').forEach(input => {
                input.addEventListener('mousedown', e => e.stopPropagation());
                input.addEventListener('change', () => saveTasks(date));
            });
        }
        
        function dragStart(e) { e.dataTransfer.setData('text/plain', e.target.id); setTimeout(() => e.target.classList.add('dragging'), 0); }
        function dragEnd(e) { e.target.classList.remove('dragging'); }
        function dragOver(e) { e.preventDefault(); }
        function drop(e) {
            e.preventDefault();
            const cardId = e.dataTransfer.getData('text/plain');
            const draggedCard = document.getElementById(cardId);
            const targetList = e.currentTarget;
            if (!draggedCard || !targetList.classList.contains('task-list')) return;
            const afterElement = getDragAfterElement(targetList, e.clientY);
            if (afterElement == null) targetList.appendChild(draggedCard);
            else targetList.insertBefore(draggedCard, afterElement);
            if (targetList.id.startsWith('done-list')) draggedCard.classList.add('done');
            else draggedCard.classList.remove('done');
            if (targetList.id.startsWith('in-progress-list')) {
                draggedCard.classList.add('minimized');
                draggedCard.querySelector('.minimize-btn').textContent = 'üîΩ';
            }
            saveTasks(activeDate);
        }
        function getDragAfterElement(container, y) {
            const draggableElements = [...container.querySelectorAll('.task-card:not(.dragging)')];
            return draggableElements.reduce((closest, child) => {
                const box = child.getBoundingClientRect();
                const offset = y - box.top - box.height / 2;
                if (offset < 0 && offset > closest.offset) return { offset: offset, element: child };
                else return closest;
            }, { offset: Number.NEGATIVE_INFINITY }).element;
        }
        function updateTitleWithPrefix(card) {
            const titleElement = card.querySelector('h4');
            const baseText = titleElement.dataset.baseText || '';
            const prefix = card.querySelector('.project-tag').textContent;
            titleElement.textContent = `${prefix}-${baseText}`;
        }
        function toggleMinimize(card) {
            const isMinimized = card.classList.toggle('minimized');
            card.querySelector('.minimize-btn').textContent = isMinimized ? 'üîΩ' : 'üîº';
            saveTasks(activeDate);
        }
        function editTask(card) {
            const titleElement = card.querySelector('h4');
            if (titleElement.isContentEditable) return;
            const taskButtons = card.querySelector('.task-buttons');
            card.setAttribute('draggable', 'false');
            titleElement.contentEditable = true;
            titleElement.textContent = titleElement.dataset.baseText;
            titleElement.focus();
            taskButtons.style.display = 'none';
            document.getSelection().selectAllChildren(titleElement);
            const finishEditing = () => {
                titleElement.contentEditable = false;
                taskButtons.style.display = 'flex';
                card.setAttribute('draggable', 'true');
                const newBaseText = titleElement.textContent.trim() || 'Nuovo task';
                titleElement.dataset.baseText = newBaseText;
                updateTitleWithPrefix(card);
                titleElement.removeEventListener('blur', finishEditing);
                titleElement.removeEventListener('keydown', handleKeyDown);
                saveTasks(activeDate);
            };
            const handleKeyDown = (e) => {
                if (e.key === 'Enter') { e.preventDefault(); finishEditing(); } 
                else if (e.key === 'Escape') finishEditing();
            };
            titleElement.addEventListener('blur', finishEditing);
            titleElement.addEventListener('keydown', handleKeyDown);
        }
        function deleteTask(card) {
            if (confirm("Sei sicuro di voler eliminare questo compito?")) {
                card.remove();
                saveTasks(activeDate);
            }
        }
        function toggleDone(card) {
            const isDone = card.classList.toggle('done');
            const targetList = isDone ? 'done-list' : 'todo-list';
            const minimizeBtn = card.querySelector('.minimize-btn');
            if (isDone) {
                card.classList.add('minimized');
                minimizeBtn.textContent = 'üîΩ';
            } else {
                card.classList.remove('minimized');
                minimizeBtn.textContent = 'üîº';
            }
            document.getElementById(`${targetList}-${activeDate}`).appendChild(card);
            saveTasks(activeDate);
        }
        function toggleProjectTag(tagElement) {
            const card = tagElement.closest('.task-card');
            tagElement.textContent = tagElement.textContent === 'PO' ? 'QUOT' : 'PO';
            updateTitleWithPrefix(card);
            saveTasks(activeDate);
        }
        function toggleTag(button) {
            button.classList.toggle('active');
            saveTasks(activeDate);
        }
        function serializeCard(card) {
            return {
                id: card.id,
                text: card.querySelector('h4').dataset.baseText,
                descrizione: card.querySelector('.descrizione-input').value,
                projectTag: card.querySelector('.project-tag').textContent,
                materiale: card.querySelector('.materiale-input').value,
                link1: card.querySelector('.link-input-1').value,
                link2: card.querySelector('.link-input-2').value,
                link3: card.querySelector('.link-input-3').value,
                location: card.querySelector('.location-btn.active')?.dataset.location || '',
                locationText: card.querySelector('.location-text').value,
                activeTags: Array.from(card.querySelectorAll('.content-tags button:not(.project-tag).active')).map(btn => btn.dataset.type),
                isDone: card.classList.contains('done'),
                minimized: card.classList.contains('minimized')
            };
        }
    </script>
</body>
</html>